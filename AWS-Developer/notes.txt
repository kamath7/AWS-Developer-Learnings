CI/CD 

- SW dev best practice 
- CI - Continuous Integration and CD - Delivery/Deployment 
- Make small changes and automate everything
- Automation good , manual bad 
- small changes and easy to catch bugs to fix 
- Shared code repo - multiple devs contributing to code
- Automated build - changes appear in code repo- 
- automated test - testing done 
- Code merged, prepared for deployment, manual descision or fully automated 
- Code Commit - Source control service enabling teams to collaborate on code, scripts etc 
- Code Build - Compiles code, runs tests and produces packages ready to deploy 
- Code Deploy - automates code deployments to any instance - EC2, lambda 
- Code Pipeline  - End to end sol, build, test and deploy app every time there is a change 
AWS Whitepaper - Practice CI&CD on AWS. 

Code Commit 
- Central code repo to store source code, binaries, images, libraries 
- manages updates from multiple sources. allows collaboration and maintains version history 


Code Deploy -

- Automated deployment service. Works with EC2 instances, on-premises and lambda 
- Quickly release new features 
- Two deployment approaches - in place and blue/green
- In place - application stopped on each instance and new release is installed. also known as rolling update
- Blue/Green - new instances provisioned and new release is installed on new instances. blue represent active deployment and green is new release 

- Codedeploy installs new version known as revision 
- instance comes back into service 
- codedeploy continues to deploy to next instance 

- Rollback - No quick fix. with in place, need to redeploy previous version which canbe time consuming 
- Blue green - green instances are registered with ELB - Elastic Load Balancer and traffic is routed away from old env . blue is everntually terminated 

-Rollback for BG - Set load balancer to redirect traffic to older env 

 BG vs In Place 
 IN place - Capacity reduced during deployment, Lambda not supported, rolling back involves re-deploy , great when deploying first time 
 Blue/Green - No capacity reduction, green instances created ahead of time, easy to switch between old and new, pay for 2 envs until old servers terminated 

 Blue/green - safest option for Prod env 

 AppSpec File 
 - Config file - Defines parameters to be used during CodeDeploy depoloyment 
 - EC2 - for ec2 and on-premises systems, yaml only 
 = lambda - yaml and json supported. file structure depends on  whether you are deploying to lambda or ec2 
 - 4 parts 
 - version - currently allowed value is 0.0 
 - OS - operating system version. either linux or windows 
 - files - config files or packages. location of any app files that need to copied or where theys hould be copied to 
 - hook - scripts that run at set points in deployments lifecycle. hoks have specific run order 

Scripts run during deployment 
- unzip files - unzip prior to deployment 
- run tests - run functional tests on newly deployed app 
- deal with load balancing - de-register and re-register instances with load balancer 

Typical folder setup 
- must be placed in root of folder - appspec.yml /scripts /config /source 

Code Deploy - life cycle event hooks 
- Hooks are run in specific order known as run order 
- Phase 1 - De register instances from load balancer 
- Phase 2 - nuts and bolts of application deployment 
- Phase 3 - Re -register instances with load balancer 

Types of hooks 
- Before hook - tasks to be run on instances before they are de-registered from load balancer 
- Block - De-register instances from Load Balancer 
- After tasks you want to run on instances after they are de registered from Load Balancer 
Run order -
- Application Stop - Gracefully stop the application
= Download bundle - Codedeploy agent copies application revision files to temporary location 
- Before Install - pre installation scripts. backing up crurent ver, decrypring files 
- Install - copy app files to final location 
- After install - Post-install script. eg config, file permissions 
- ApplicationStart: start any services stopped during applicationstop 
- ValidateService - Run tests to validate service 
- BeforeAllowTraffic - Tasks you want to run on instances before they're registered with load balancer 
- AllowTraffic - Register instances with load balancer 
- After - Tasks you want to run on instances after they are registered with Load Balancer 
